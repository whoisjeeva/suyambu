"use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function _createClass(e,t,r){return t&&_defineProperties(e.prototype,t),r&&_defineProperties(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function _createForOfIteratorHelper(e,t){var r,n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=_unsupportedIterableToArray(e))||t&&e&&"number"==typeof e.length)return n&&(e=n),r=0,{s:t=function(){},n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:t};throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var l,a=!0,o=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return a=e.done,e},e:function(e){o=!0,l=e},f:function(){try{a||null==n.return||n.return()}finally{if(o)throw l}}}}function _unsupportedIterableToArray(e,t){if(e){if("string"==typeof e)return _arrayLikeToArray(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Map"===(r="Object"===r&&e.constructor?e.constructor.name:r)||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?_arrayLikeToArray(e,t):void 0}}function _arrayLikeToArray(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}var Native={showAlertWithElements:function(e){var t,r="",n="\n\n",l=_createForOfIteratorHelper(e=JSON.parse(e));try{for(l.s();!(t=l.n()).done;){var a=t.value,o=a.selector.split(" ").pop().split(":")[0],i=(r+="".concat(o,", "),a.attrs);if(n+="Attributes for '".concat(o,"':\n"),0===i.length)n+="-";else{var s,c=_createForOfIteratorHelper(i);try{for(c.s();!(s=c.n()).done;){var u=s.value;n+="".concat(u.name,"=").concat(u.value,", ")}}catch(e){c.e(e)}finally{c.f()}n=n.substring(0,n.length-2)}n+="\n\n"}}catch(e){l.e(e)}finally{l.f()}r=r.substring(0,r.length-2),n=n.substring(0,n.length-2),alert("Elements with tag names '".concat(r,"' selected\n\nTotal of ").concat(e.length," elements.").concat(n))},showToast:function(e){alert(e)}},ElementFinder=function(){function e(){_classCallCheck(this,e),this.elements=[]}return _createClass(e,[{key:"init",value:function(){document.addEventListener("click",function(e){e.stopPropagation()},!0),this.bindLongPressEvent()}},{key:"findTree",value:function(e){var t=e,r=[],n=Array.prototype.slice.call(t.parentElement.children),l=n.indexOf(t)+1;for(r.push({tagName:t.tagName.toLowerCase(),nth:l,attrs:this._attrToArray(t,t.attributes)});;){var a=(t=t.parentElement).tagName.toLowerCase();if("body"===a)break;l=(n=Array.prototype.slice.call(t.parentElement.children)).indexOf(t)+1,r.push({tagName:a,nth:l,attrs:this._attrToArray(t,t.attributes)})}return r.reverse(),r}},{key:"toSelector",value:function(e){for(var t="",r=0;r<e.length;r++){var n=e[r];t+=n.tagName+":nth-child("+n.nth+") "}return t.trim()}},{key:"switchParenElement",value:function(){for(var e=this,t=[],r=0;r<this.elements.length;r++){var n=document.querySelectorAll(this.elements[r].selector)[this.elements[r].elIndex];if(this.elements[r].isFindSimilar)for(var l=this.findSimilar(n),a=0;a<l.length;a++){var o=document.querySelectorAll(l[a].selector)[l[a].elIndex];o.style.boxShadow="",o.style.backgroundColor="",o.style.color=""}for(var i=n.parentElement,s=this.findTree(i),s=this.toSelector(s),c=document.querySelectorAll(s),u=0,h=0;h<c.length;h++)if(c[h]===n){u=h;break}if(n.style.boxShadow="",n.style.backgroundColor="",n.style.color="",i.style.boxShadow="0 0 0 2px yellow",i.style.backgroundColor="yellow",i.style.color="black",this.elements[r].isFindSimilar)for(var m=this.findSimilar(i),f=0;f<m.length;f++){var d=document.querySelectorAll(m[f].selector)[m[f].elIndex];d.style.boxShadow="0 0 0 2px yellow",d.style.backgroundColor="yellow",d.style.color="black"}t.push({selector:s,elIndex:u,attrs:this._attrToArray(i,i.attributes),isFindSimilar:this.elements[r].isFindSimilar,xpath:this.createXpath(i)})}return 0<t.length&&(this.elements=t,setTimeout(function(){Native.showAlertWithElements(JSON.stringify(e.elements))},1),!0)}},{key:"getElementByXpath",value:function(e){return document.evaluate(e,document,null,XPathResult.FIRST_ORDERED_NODE_TYPE,null).singleNodeValue}},{key:"createXpath",value:function(e){if(""!==e.id)return'id("'+e.id+'")';if(e===document.body)return e.tagName;for(var t=0,r=e.parentNode.childNodes,n=0;n<r.length;n++){var l=r[n];if(l===e)return this.createXpath(e.parentNode)+"/"+e.tagName+"["+(t+1)+"]";1===l.nodeType&&l.tagName===e.tagName&&t++}}},{key:"findSimilar",value:function(e){for(var t=e.getBoundingClientRect(),r=t.width,n=t.height,t=this.findTree(e),l=this._concatTagNames(t),a=e.querySelectorAll("*"),o=document.querySelectorAll("body *"),i=[],s=0;s<o.length;s++){var c=o[s],u=c.getBoundingClientRect(),h=u.width,u=u.height,m=this.findTree(c),m=this._concatTagNames(m),f=c.querySelectorAll("*");if(r===h&&n===u&&c.tagName===e.tagName&&m===l||m===l&&c.tagName===e.tagName&&f.length===a.length)for(var h=this.findTree(c),d={selector:"body "+this.toSelector(h),elIndex:0,attrs:this._attrToArray(c,c.attributes)},y=document.querySelectorAll(d.selector),g=0;g<y.length;g++)if(y[g]===c&&c!==e){d.elIndex=g,i.push(d),c.style.boxShadow="0 0 0 2px yellow",c.style.backgroundColor="yellow",c.style.color="black";break}}return i}},{key:"bindLongPressEvent",value:function(){var i=this;document.addEventListener("contextmenu",function(e){if(e.preventDefault(),!i._isHidden(e.target)){var t=null;if(0!=i.elements.length)for(var r=0;r<i.elements.length;r++)if(document.querySelectorAll(i.elements[r].selector)[i.elements[r].elIndex]===e.target){t=i.elements[r],e.target.style.boxShadow="",e.target.style.backgroundColor="",e.target.style.color="";break}if(null!==t)i.elements.splice(i.elements.indexOf(t),1);else{for(var n=i.findTree(e.target),n=i.toSelector(n),l=document.querySelectorAll(n),a=0,o=0;o<l.length;o++)if(l[o]===e.target){a=o;break}i.elements.push({selector:"body "+n,elIndex:a,attrs:i._attrToArray(e.target,e.target.attributes),isFindSimilar:!1,xpath:i.createXpath(e.target)}),e.target.style.boxShadow="0 0 0 2px yellow",e.target.style.backgroundColor="yellow",e.target.style.color="black"}setTimeout(function(){Native.showAlertWithElements(JSON.stringify(i.elements))},1)}},!1)}},{key:"addSimilarElements",value:function(){for(var e=this.elements.length,t=!1,r=0;r<e;r++){var n=document.querySelectorAll(this.elements[r].selector)[this.elements[r].elIndex],l=this.findSimilar(n);0<l.length&&(t=!0),this.elements[r].isFindSimilar=!0;for(var a=0;a<l.length;a++){var o=document.querySelectorAll(l[a].selector)[l[a].elIndex];o.style.boxShadow="0 0 0 2px yellow",o.style.backgroundColor="yellow",o.style.color="black"}}return t}},{key:"looksGood",value:function(){return"Looks good! total"+this.elements.length+" element(s) found."}},{key:"getSelectedElements",value:function(){return 0===this.elements.length?null:JSON.stringify(this.elements)}},{key:"findNearestElement",value:function(e){var t=this;if(0===this.elements.length)Native.showToast("please select an element first");else{for(var r=document.querySelectorAll(this.elements[0].selector)[this.elements[0].elIndex],n=r,l=null,a=e.toLowerCase();;){for(var o=!1,i=n.querySelectorAll("*"),s=0;s<i.length;s++)if(i[s].tagName.toLowerCase()===a&&i[s]!==r&&!this._isHidden(i[s])){o=!0,l=i[s];break}if(o||"body"===n.tagName.toLowerCase)break;n=n.parentElement}if(null===l)return Native.showToast("No element exist with '"+a+"' tag name."),setTimeout(function(){Native.showAlertWithElements(JSON.stringify(t.elements))},1),"No element exist with '"+a+"' tag name.";for(var e=this.findTree(l),e=this.toSelector(e),c=document.querySelectorAll(e),u=0,h=0;h<c.length;h++)if(c[h]===l){u=h;break}for(var m=0;m<this.elements.length;m++){var f=document.querySelectorAll(this.elements[m].selector)[this.elements[m].elIndex];f.style.boxShadow="",f.style.backgroundColor="",f.style.color=""}this.elements=[],this.elements.push({selector:"body "+e,elIndex:u,attrs:this._attrToArray(l,l.attributes),isFindSimilar:!1,xpath:this.createXpath(l)}),setTimeout(function(){Native.showAlertWithElements(JSON.stringify(t.elements))},1),r.style.boxShadow="",r.style.backgroundColor="",r.style.color="",l.style.boxShadow="0 0 0 2px yellow",l.style.backgroundColor="yellow",l.style.color="black"}}},{key:"confirmElements",value:function(){0<this.elements.length&&Native.confirmElements(JSON.stringify(this.elements))}},{key:"_isHidden",value:function(e){return null===e.offsetParent}},{key:"_concatTagNames",value:function(e){for(var t="",r=0;r<e.length;r++)t+=e[r].tagName+" ";return t.trim()}},{key:"_concatAttrClassNames",value:function(e){for(var t="",r=0;r<e.length;r++){var n=e[r];"class"===n.name&&(t+=n.value+" ")}return t.trim()}},{key:"_concatTagNamesWithNth",value:function(e){for(var t="",r=0;r<e.length;r++){var n=e[r];t+=n.tagName+" "+n.nth+" "}return t.trim()}},{key:"_attrToArray",value:function(e,t){for(var r=[],n=0;n<t.length;n++){var l=t[n];"href"===l.name?r.push({name:l.name,value:e.href}):"src"===l.name?r.push({name:l.name,value:e.currentSrc}):"action"===l.name?r.push({name:l.name,value:e.action}):r.push({name:l.name,value:l.value})}return r}}]),e}();window.elementFinder=new ElementFinder;